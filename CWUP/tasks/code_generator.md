

# Generate Engine Mapping Code from Godot ClassDB

## Goal
Extend `tools/generate_sml_element_docs.gd` to generate **compiled mapping code** in C# for the runtime. The generated code becomes the single source of truth for type, property, and event mappings.

---

## Code Generation Hint (Use existing generator as template)
Use the existing function `_generate_reference_sml(names)` in `tools/generate_sml_element_docs.gd` as the template/pattern for code generation:

- iterate over all type names
- collect `parent`, `props`, `signals`
- build deterministic text output via string concatenation
- write files using `FileAccess.open(path, FileAccess.WRITE)` and `store_string(...)`
- keep output stable by sorting types/properties/events

Instead of emitting `docs/sms-reference.sml`, emit compiled mapping code into:

```
NoCodeRunner/Generated/
    SchemaTypes.cs
    SchemaProperties.cs
    SchemaEvents.cs
```

The Generated folder is overwritten on every run.

Manual types (e.g. `Markdown`) must be emitted explicitly and must not call ClassDB.

---

## Generated Structures

### Types
```
TypeDef {
    string Name
    string Parent
    bool IsCollection
}
```

### Properties
```
PropDef {
    string TypeName
    string SmlName
    string GodotName
    string ValueType
}
```

### Events
```
EventDef {
    string TypeName
    string SmsName
    string GodotSignal
    string[] ParamNames
    string[] ParamTypes
}
```

Also emit lookup tables:

- `TypesByName[type] -> TypeDef`
- `PropsByType[type][smlName] -> PropDef`
- `EventsByType[type][smsName] -> EventDef`

---

## Rules

- Property names use normalized lowerCamelCase SML naming
- Event names use normalized lowerCamelCase SMS naming
- Only supported types from `_collect_properties` may be emitted
- Manual types are defined directly in generator
- Deterministic ordering is required (sorted output)

---

## Runtime Expectations

The runtime must:

1. Lookup a TypeDef by name
2. Apply properties via generic `node.set(godotName, value)`
3. Bind signals via generic dispatcher using event definitions

No reflection-based discovery is allowed at runtime.

---

## Forbidden Patterns

The following must NOT exist in runtime code:

- `match typeName:` mapping logic
- per-control mapping classes
- hardcoded property tables per control
- reading Godot ClassDB at runtime

Mappings must be pure data generated by the generator.

---

## Definition of Done

- Running `./run_runner.sh docs` regenerates Generated/*.cs files
- Runtime compiles without manual mapping tables
- Adding a new Godot control only requires re-running generator
- Removing a property in Godot only changes generated files
- Runtime contains no per-control mapping logic